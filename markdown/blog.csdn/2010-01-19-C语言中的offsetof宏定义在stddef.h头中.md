offsetof(TYPE, MEMBER), 这个宏定义在<stddef.h>这个标准头中.
 
意义: 获得一个成员在结构中的偏移量.
返回: size_t类型的偏移量值.
 
深层次的意义: 由于编译器实现的不同, 可能会在结构的成员之间留有内存"空洞", 所以, 往往我们不能明确的确定一个结构的成员具体在哪个内存位置, 因此, 需要知道每个成员相对结构首地址的偏移量.
 
以下分析成立的假设:
  1. 编译器在确定一个结构成员时, 首先确定结构的首地址.
  2. 然后根据自己的内存分配原则(包括内存留"空洞"的原则), 获得成员的偏移量.
  3. 根据首地址和偏移量最终确定了成员的位置.
 
定义的原型: #define offsetof(TYPE, MEMBER) ((size_t) &((TYPE *)0)->MEMBER)
 
宏的定义主体是: ((size_t) &((TYPE *)0)->MEMBER)
首先, offsetof将0转换成为TYPE的指针类型: ((TYPE *)0)
然后, 通过->运算符, 获取成员MEMBER((TYPE *)0)->MEMBER, 根据假设, 此时编译器根据自己的规则确定了成员MEMBER的地址为: 首地址+偏移量.
那么, &((TYPE *)0)->MEMBER就可以得到成员MEMBER的地址.  也就是说&((TYPE *)0)->MEMBER = 首地址 + 偏移量.
而我们的首地址是: (TYPE *)0, 其值为0.  所以: &((TYPE *)0)->MEMBER = 0 + 偏移量
因此, 可以得出&((TYPE *)0)->MEMBER就是成员MEMBER相对结构的首地址的偏移量.
最后, 将这个偏移量转换为size_t类型, 就是最终这个宏得到的结果: 结构的成员相对于结构首地址的偏移量.
 
由于没有编译器相关知识背景, 上面分析纯粹是建立在一些假设的背景之上, 如有出入, 请高手点拨.
 
